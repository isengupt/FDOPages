function n(n){return n&&"object"==typeof n&&"default"in n?n.default:n}var t=require("immer"),r=require("react"),e=n(r),o=require("redux"),u=n(require("redux-thunk")),i=n(require("memoizerific")),c=n(require("is-plain-object")),a=n(require("debounce")),f=require("use-memo-one"),s=r.createContext(),v="undefined"!=typeof window?r.useLayoutEffect:r.useEffect;function p(n){return function(t,e){var o=r.useContext(n),u=r.useRef(t),i=r.useRef(),c=r.useRef(!0),a=r.useRef(),f=r.useReducer(function(n){return n+1},0)[1];if(a.current||u.current!==t||void 0===i.current)try{i.current=t(o.getState())}catch(n){if("development"===process.env.NODE_ENV){var s="An error occurred trying to map state in a useStoreState hook: "+n.message+".";throw a.current&&(s+="\nThis error may be related to the following error:\n"+a.current.stack+"\n\nOriginal stack trace:"),new Error(s)}throw a.current||n}return v(function(){u.current=t,a.current=void 0}),v(function(){var n=function(){try{var n=u.current(o.getState());if("function"==typeof e?e(i.current,n):i.current===n)return;i.current=n}catch(n){a.current=n}c.current&&f({})},t=o.subscribe(n);return n(),function(){c.current=!1,t()}},[]),i.current}}var d=p(s);function l(n){return function(t){return t(r.useContext(n).getActions())}}var y=l(s);function m(n){return function(){return r.useContext(n).dispatch}}var h=m(s);function g(){return r.useContext(s)}function S(n){return function(){var t=r.useContext(n),e=r.useState(!1),o=e[0],u=e[1];return r.useEffect(function(){t.persist.resolveRehydration().then(function(){return u(!0)})},[]),o}}var b=S(s);function w(){return(w=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(n[e]=r[e])}return n}).apply(this,arguments)}var x=function(n){var t;return(t={}).$ep_a=!0,t.fn=n,t},P=[function(n){return n}],j=function(n){return function n(t){var r=Object.keys(t).reduce(function(n,r){return null==Object.getOwnPropertyDescriptor(t,r).get&&(n[r]=t[r]),n},{});return Object.keys(r).forEach(function(t){c(r[t])&&(r[t]=n(r[t]))}),r}(n)},O=function(n){return null!=n&&"object"==typeof n&&"function"==typeof n.then};function _(n,t){return n.reduce(function(n,t){return c(n)?n[t]:void 0},t)}var A=function(n,t,r){0!==n.length?n.reduce(function(t,e,o){return t[e]=o+1===n.length?r:t[e]||{},t[e]},t):"object"==typeof r&&(Object.keys(t).forEach(function(n){delete t[n]}),Object.keys(r).forEach(function(n){t[n]=r[n]}))};function I(n,r,e,o){var u=function(n){return void 0===n&&(n=!1),function(r,e,o){if(n){var u=_(r,e),i=o(u);return u!==i?function n(t,r,e){if(0===t.length)return e;var o=w({},r),u=t[0];return o[u]=1===t.length?e:n(t.slice(1),o[u],e),o}(r,e,i):e}if(0===r.length){var c=t.createDraft(e),a=o(c);return a?t.isDraft(a)?t.finishDraft(a):a:t.finishDraft(c)}var f=r.slice(0,r.length-1),s=t.createDraft(e),v=_(f,e),p=o(_(r,s));return p&&(v[r[r.length-1]]=p),t.finishDraft(s)}}(n);return function(n,t){var i=function(n,t){var e=r[t.type];return e?function(n,t,r,e){return u(e,n,function(n){return r(n,t.payload)})}(n,t,e,e.definition.meta.parent):n}(n,t),c=e.length>0?function(n,t){return e.reduce(function(n,r){var e=r.key,o=r.reducer;return u(r.parentPath,n,function(n){return n[e]=o(n[e],t),n})},n)}(i,t):i;return n!==c&&o.forEach(function(n){var t=n.bindComputedProperty,r=_(n.parentPath,c);null!=r&&t(r)}),c}}var k={getItem:function(){},setItem:function(){},removeItem:function(){}};function T(n){try{return"undefined"!=typeof window&&void 0!==window[n]?window[n]:k}catch(n){return k}}var C=T("localStorage"),R=T("sessionStorage");function q(n,t){void 0===n&&(n=R),void 0===t&&(t=[]),"string"==typeof n&&("localStorage"===n?n=C:"sessionStorage"===n?n=R:("development"===process.env.NODE_ENV&&console.warn("Invalid storage provider specified for Easy Peasy persist: "+n+'\nValid values include "localStorage", "sessionStorage" or a custom storage engine.'),n=k));var r=t.reverse(),e=function(t,e){var o=e.substr(e.indexOf("@")+1),u=n===C||n===R?JSON.parse(t).data:t;return r.reduce(function(n,t){return t.out(n,o)},u)},o=O(n.getItem("_"));return{isAsync:o,getItem:function(t){if(o)return n.getItem(t).then(function(n){return null!=n?e(n,t):void 0});var r=n.getItem(t);return null!=r?e(r,t):void 0},setItem:function(r,e){return n.setItem(r,function(r,e){var o=e.substr(e.indexOf("@")+1),u=t.reduce(function(n,t){return t.in(n,o)},r);return n===C||n===R?JSON.stringify({data:u}):u}(e,r))},removeItem:function(t){return n.removeItem(t)}}}function D(n,t,r){var e=Object.keys(n);return t.length>0&&(e=e.reduce(function(n,r){return-1!==t.findIndex(function(n){return n===r})?[].concat(n,[r]):n},[])),r.length>0&&(e=e.reduce(function(n,t){return-1!==r.findIndex(function(n){return n===t})?n:[].concat(n,[t])},[])),e}function M(n,t){return function(){return new Promise(function(r,e){t.internals.t.forEach(function(o){var u=o.path,i=o.config,c=i.storage,a=i.whitelist,f=i.blacklist,s=D(_(u,t.getState()),a,f);s.length>0?Promise.all(s.map(function(t){var r=[].concat(u,[t]);return c.removeItem(n(r))})).then(function(){return r()},e):r()})})}}function N(n,t,r,e){var o=Promise.resolve();return r.internals.t.length>0&&r.internals.t.forEach(function(u){var i=u.path,a=u.config,f=a.blacklist,s=a.mergeStrategy,v=a.storage,p=a.whitelist;if(!e||!(i.length<1||i[0]!==e)){var d=r.internals.o,l=D(j(_(i,d)),p,f),y=function(n,t){return null!=n&&null!=t&&(typeof n!=typeof t||Array.isArray(n)&&!Array.isArray(t))},m=function(n,t){if("overwrite"===s)A(i,n,t);else if("merge"===s){var r=_(i,n);Object.keys(t).forEach(function(n){y(r[n],t[n])||(r[n]=t[n])})}else"mergeDeep"===s&&function n(t,r){Object.keys(r).forEach(function(e){var o=r[e];y(t[e],o)||(c(o)?(t[e]=t[e]||{},n(t[e],o)):t[e]=o)})}(_(i,n),t)};if(v.isAsync){var h=l.reduce(function(t,r){var e=[].concat(i,[r]),o=v.getItem(n(e));return O(o)&&t.push({key:r,dataPromise:o}),t},[]);h.length>0&&(o=Promise.all(h.map(function(n){return n.dataPromise})).then(function(n){var r=n.reduce(function(n,t,r){return void 0!==t&&(n[h[r].key]=t),n},{});0!==Object.keys(r).length&&(m(d,r),t(d))}))}else{var g=l.reduce(function(t,r){var e=[].concat(i,[r]),o=v.getItem(n(e));return void 0!==o&&(t[r]=o),t},{});m(d,g),t(d)}}}),o}function E(n){return function(){return function(t){return function(r){var e=t(r);if(r&&n.internals.u[r.type]&&n.internals.u[r.type].length>0){var o=n.internals.i[r.type];n.internals.u[r.type].forEach(function(n){n({type:o?o.definition.meta.type:r.type,payload:r.payload,error:r.error,result:r.result})})}return e}}}}function J(n){return function(t){return function(r){return function(e){return n.internals.s.currentState=t.getState(),n.internals.s.isInReducer=!0,r(e)}}}}function L(n){return function(t){return function(r){return function(e){if(0===n.internals.v.length)return r(e);var o=t.getState(),u=r(e),i=t.getState();return n.internals.v.forEach(function(n){var t=_(n.meta.parent,o),r=_(n.meta.parent,i);if(t!==r){var u=n.dependencyResolvers.map(function(n){return n(t)}),c=n.dependencyResolvers.map(function(n){return n(r)});u.some(function(n,t){return n!==c[t]})&&n.actionCreator(u,c,e)}}),u}}}}function W(n,t){void 0===t&&(t={});var r=j(n),e=t.compose,f=t.devTools,s=void 0===f||f,v=t.disableImmer,p=void 0!==v&&v,d=t.enhancers,l=void 0===d?[]:d,y=t.initialState,m=void 0===y?{}:y,h=t.injections,g=t.middleware,S=void 0===g?[]:g,b=t.mockActions,P=void 0!==b&&b,k=t.name,T=void 0===k?"EasyPeasyStore":k,C=t.reducerEnhancer,R=void 0===C?function(n){return n}:C,W=function(n){return w({},n,{ePRS:x(function(n,t){return t})})},Y={},z=W(r),V=[],$=function(n){return"["+T+"]@"+n.join(".")},B=function(n,t){var r=Promise.resolve(),e=a(function(){0!==t.internals.t.length&&(r=Promise.all(t.internals.t.reduce(function(r,e){var o=e.path,u=e.config,i=u.storage,c=u.whitelist,a=u.blacklist,f=t.getState(),s=D(j(_(o,f)),c,a);return r.concat(s.map(function(t){var r=[].concat(o,[t]);return Promise.resolve(i.setItem(n(r),_(r,f)))}))},[])))},1e3);return{persist:e,clear:M(n,t),flush:function(){try{return e.flush(),Promise.resolve(r).then(function(){})}catch(n){return Promise.reject(n)}}}}($,Y),F=function(n,t){return function(){return function(r){return function(e){var o=r(e);return e&&"@action.ePRS"!==e.type&&t.internals.t.length>0&&n.persist(o),o}}}}(B,Y),G=function(n){return Y.internals.i["@action.ePRS"](n)},H=function(n){void 0===n&&(n={}),Y.internals=function(n){var t=n.disableImmer,r=n.reducerEnhancer,e=function(n,t,r,e){var o=t,u={},a={},f={},s={},v=[],p=[],d=[],l={},y={},m=[],h=[],g={isInReducer:!1,currentState:o};return function n(y,S){return Object.keys(y).forEach(function(b){var x=y[b],P=[].concat(S,[b]),j={parent:S,path:P,key:b},I=function(){var n=_(S,t);A(P,o,n&&b in n?n[b]:x)};if("$ep_p"!==b)if(null!=x&&"object"==typeof x)if(x.$ep_a||x.$ep_aO){var k=w({},x),T=k.$ep_a?"@action":"@actionOn";k.meta={actionName:j.key,category:T,type:T+"."+j.path.join("."),parent:j.parent,path:j.path},k.actionCreator=function(n,t){var r=function(r){var e={type:n.meta.type,payload:r};return n.$ep_aO&&n.meta.resolvedTargets&&(r.resolvedTargets=[].concat(n.meta.resolvedTargets)),t.dispatch(e)};return r.type=n.meta.type,r}(k,e),k.actionCreator.definition=k,k.fn.definition=k,u[k.meta.type]=k.actionCreator,f[k.meta.type]=k.fn,"ePRS"!==j.key&&(k.$ep_aO?(m.push(k),A(P,l,k.actionCreator)):A(P,a,k.actionCreator))}else if(x.$ep_t||x.$ep_tO){var C=w({},x),R=(C.$ep_t?"@thunk":"@thunkOn")+"."+j.path.join(".");C.meta={actionName:j.key,parent:j.parent,path:j.path,type:R,startType:R+"(start)",successType:R+"(success)",failType:R+"(fail)"},C.thunkHandler=function(n,t,r,e){return function(o){var u={dispatch:t.dispatch,getState:function(){return _(n.meta.parent,t.getState())},getStoreActions:function(){return e},getStoreState:t.getState,injections:r,meta:{key:n.meta.actionName,parent:n.meta.parent,path:n.meta.path}};return n.$ep_tO&&n.meta.resolvedTargets&&(o.resolvedTargets=[].concat(n.meta.resolvedTargets)),n.fn(_(n.meta.parent,e),o,u)}}(C,e,r,a),A(P,s,C.thunkHandler),C.actionCreator=function(n,t){var r=function(r){var e=function(e){t.dispatch({type:n.meta.failType,payload:r,error:e}),t.dispatch({type:n.meta.type,payload:r,error:e})},o=function(e){t.dispatch({type:n.meta.successType,payload:r,result:e}),t.dispatch({type:n.meta.type,payload:r,result:e})};t.dispatch({type:n.meta.startType,payload:r});try{var u=t.dispatch(function(){return n.thunkHandler(r)});return O(u)?u.then(function(n){return o(n),n}).catch(function(n){throw e(n),n}):(o(u),u)}catch(n){throw e(n),n}};return r.type=n.meta.type,r.successType=n.meta.successType,r.failType=n.meta.failType,r.startType=n.meta.startType,r}(C,e),C.actionCreator.definition=C,u[C.meta.type]=C.actionCreator,C.$ep_tO?(m.push(C),A(P,l,C.actionCreator)):A(P,a,C.actionCreator)}else if(x.$ep_c){var D=_(S,o),M=function(n,t,r,e,o){var u=i(1)(r.fn);return function(i){Object.defineProperty(i,t,{configurable:!0,enumerable:!0,get:function(){var t;if(e.isInReducer)t=e.currentState;else{if(null==o.getState)return;try{t=o.getState()}catch(n){return void("development"===process.env.NODE_ENV&&console.warn("Invalid access attempt to a computed property"))}}var i=_(n,t),c=r.stateResolvers.map(function(n){return n(i,t)});return u.apply(void 0,c)}})}}(S,b,x,g,e);M(D),v.push({key:b,parentPath:S,bindComputedProperty:M})}else if(x.$ep_r)p.push({key:b,parentPath:S,reducer:x.fn});else if(x.$ep_e){var N=w({},x),E="@effectOn."+j.path.join(".");N.meta={type:E,actionName:j.key,parent:j.parent,path:j.path,startType:E+"(start)",successType:E+"(success)",failType:E+"(fail)"};var J=function(n,t,r,e){var o,u=_(n.meta.parent,e);return function(i){var c={dispatch:t.dispatch,getState:function(){return _(n.meta.parent,t.getState())},getStoreActions:function(){return e},getStoreState:t.getState,injections:r,meta:{key:n.meta.actionName,parent:n.meta.parent,path:n.meta.path}};if(void 0!==o){var a=o();o=void 0,O(a)&&a.catch(function(n){console.log(n)})}var f=n.fn(u,i,c);if(O(f))return f.then(function(n){"function"==typeof n&&"production"!==process.env.NODE_ENV&&console.warn("[easy-peasy] You have an effect which is asynchronously resolving a dispose function. This is considered an anti-pattern. Please read the API documentation for more information.")});"function"==typeof f&&(o=f)}}(N,e,r,a),L=function(n,t,r){var e=function(e,o,u){var i={prev:e,current:o,action:u},c=function(r){return t.dispatch({type:n.meta.failType,change:i,error:r})},a=function(){return t.dispatch({type:n.meta.successType,change:i})};t.dispatch({type:n.meta.startType,change:i});try{var f=t.dispatch(function(){return r(i)});return O(f)?f.then(function(n){return a(),n}).catch(function(n){c(n)}):(a(),f)}catch(n){throw c(n),n}};return e.type=n.meta.type,e.startType=n.meta.startType,e.successType=n.meta.successType,e.failType=n.meta.failType,e}(N,e,J);N.actionCreator=L,d.push(N)}else c(x)?(null==_(P,o)&&A(P,o,{}),n(x,P)):I();else I();else h.push(function(n,t){return void 0===t&&(t={}),{path:n,config:{blacklist:t.blacklist||[],mergeStrategy:t.mergeStrategy||"merge",storage:q(t.storage,t.transformers),whitelist:t.whitelist||[]}}}(S,x))})}(n,[]),function(n,t,r,e){n.forEach(function(n){var o=n.targetResolver(_(n.meta.parent,t),t),u=(Array.isArray(o)?o:[o]).reduce(function(n,t){return"function"==typeof t&&t.definition.meta.type&&r[t.definition.meta.type]?n.push(t.definition.meta.type):"string"==typeof t&&n.push(t),n},[]);n.meta.resolvedTargets=u,u.forEach(function(t){var o=e[t]||[];o.push(r[n.meta.type]),e[t]=o})})}(m,a,u,y),{i:u,p:a,l:f,m:v,h:p,s:g,o:o,v:d,g:l,u:y,t:h}}(n.model,n.initialState,n.injections,n.references),o=e.m;return{i:e.i,p:e.p,m:o,s:e.s,o:e.o,v:e.v,g:e.g,u:e.u,t:e.t,reducer:r(I(t,e.l,e.h,o))}}({disableImmer:p,initialState:n,injections:h,model:z,reducerEnhancer:R,references:Y})},K=e||(s&&"undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({name:T}):o.compose);H(m);var Q=[J(Y)].concat(S,[u,E(Y),L(Y),F]);P&&Q.push(function(){return function(){return function(n){null!=n&&V.push(n)}}});var U=o.createStore(Y.internals.reducer,Y.internals.o,K.apply(void 0,[o.applyMiddleware.apply(void 0,Q)].concat(l)));U.subscribe(function(){Y.internals.s.isInReducer=!1}),Y.dispatch=U.dispatch,Y.getState=U.getState;var X=function(){Object.keys(U.dispatch).forEach(function(n){delete U.dispatch[n]}),Object.keys(Y.internals.p).forEach(function(n){U.dispatch[n]=Y.internals.p[n]})};X();var Z=function(n){var t=U.getState();n&&delete t[n],H(t),U.replaceReducer(Y.internals.reducer),G(Y.internals.o),X()},nn=N($,G,Y);return Object.assign(U,{addModel:function(n,t){z[n]&&"production"!==process.env.NODE_ENV&&(console.warn('easy-peasy: The store model already contains a model definition for "'+n+'"'),U.removeModel(n)),z[n]=t,Z();var r=N($,G,Y,n);return{resolveRehydration:function(){return r}}},clearMockedActions:function(){V=[]},getActions:function(){return Y.internals.p},getListeners:function(){return Y.internals.g},getMockedActions:function(){return[].concat(V)},persist:{clear:B.clear,flush:B.flush,resolveRehydration:function(){return nn}},reconfigure:function(n){z=W(n),Z()},removeModel:function(n){z[n]?(delete z[n],Z(n)):"production"!==process.env.NODE_ENV&&console.warn('easy-peasy: The store model does not contain a model definition for "'+n+'"')}})}var Y=!1;t.setAutoFreeze(!1),exports.StoreProvider=function(n){return e.createElement(s.Provider,{value:n.store},n.children)},exports.action=x,exports.actionOn=function(n,t){var r;return(r={}).$ep_aO=!0,r.fn=t,r.targetResolver=n,r},exports.computed=function(n,t){var r,e;return"function"==typeof t?((e={}).$ep_c=!0,e.fn=t,e.stateResolvers=n,e):((r={}).$ep_c=!0,r.fn=n,r.stateResolvers=P,r)},exports.createComponentStore=function(n,t){return Y||(Y=!0,"development"===process.env.NODE_ENV&&console.log("easy-peasy: Deprecation Warning.\n\nYou are using the createComponentStore API. This API has been deprecated and will be removed in the next major release.\n\nWe recommend that you instead use the newer useLocalStore API, which is a much more flexible and concise API:\n\n    https://easy-peasy.now.sh/docs/api/use-local-store.html\n")),function(e){var o=r.useMemo(function(){return W("function"==typeof n?n(e):n,t)},[]),u=r.useRef(o.getState()),i=r.useState(function(){return o.getState()}),c=i[0],a=i[1];return r.useEffect(function(){return o.subscribe(function(){var n=o.getState();u.current!==n&&(u.current=n,a(n))})},[o]),[c,o.getActions()]}},exports.createContextStore=function(n,t){var o=r.createContext();return{Provider:function(r){var u=r.children,i=r.initialData,c=f.useMemoOne(function(){return W("function"==typeof n?n(i):n,t)},[]);return e.createElement(o.Provider,{value:c},u)},useStore:function(){return r.useContext(o)},useStoreState:p(o),useStoreActions:l(o),useStoreDispatch:m(o),useStoreRehydrated:S(o)}},exports.createStore=W,exports.createTransform=function(n,t,r){void 0===r&&(r={});var e=r.whitelist||null,o=r.blacklist||null;function u(n){return!(!e||-1!==e.indexOf(n))||!(!o||-1===o.indexOf(n))}return{in:function(t,r,e){return!u(r)&&n?n(t,r,e):t},out:function(n,r,e){return!u(r)&&t?t(n,r,e):n}}},exports.createTypedHooks=function(){return{useStoreActions:y,useStoreDispatch:h,useStoreState:d,useStoreRehydrated:b,useStore:g}},exports.debug=function(n){return t.isDraft(n)?t.current(n):n},exports.generic=function(n){return n},exports.memo=function(n,t){return i(t)(n)},exports.persist=function(n,t){var r;return"undefined"==typeof window?n:w({},n,((r={}).$ep_p=t,r))},exports.reducer=function(n){var t;return(t={}).$ep_r=!0,t.fn=n,t},exports.thunk=function(n){var t;return(t={}).$ep_t=!0,t.fn=n,t},exports.thunkOn=function(n,t){var r;return(r={}).$ep_tO=!0,r.fn=t,r.targetResolver=n,r},exports.unstable_effectOn=function(n,t){var r;return(r={}).$ep_e=!0,r.dependencyResolvers=n,r.fn=t,r},exports.useLocalStore=function(n,t,e){void 0===t&&(t=[]);var o=r.useRef(),u=r.useRef(),i=f.useMemoOne(function(){var t=null!=o.current?o.current.getState():void 0,r=null!=e?e(t,u.current):void 0,i=W(n(t),r);return u.current=r,o.current=i,i},t),c=r.useState(function(){return i.getState()}),a=c[0],s=c[1];return r.useEffect(function(){return i.subscribe(function(){var n=i.getState();a!==n&&s(n)})},[i]),[a,i.getActions(),i]},exports.useStore=g,exports.useStoreActions=y,exports.useStoreDispatch=h,exports.useStoreRehydrated=b,exports.useStoreState=d;
//# sourceMappingURL=easy-peasy.js.map
